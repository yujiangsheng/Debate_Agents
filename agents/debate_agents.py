#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è¾©è®ºæ™ºèƒ½ä½“ - æ­£æ–¹Aå’Œåæ–¹B
=========================

æœ¬æ¨¡å—å®ç°è¾©è®ºç³»ç»Ÿä¸­çš„ä¸¤ä¸ªè¾©è®ºæ™ºèƒ½ä½“ï¼š
- DebateAgentA: æ­£æ–¹ï¼Œæ”¯æŒè¾©é¢˜ä¸»å¼ 
- DebateAgentB: åæ–¹ï¼Œåå¯¹è¾©é¢˜ä¸»å¼ 

é€šè¿‡ DebateAgent åŸºç±»å’Œ stance å‚æ•°å®ç°ä»£ç å¤ç”¨ï¼Œ
ä¸¤ä¸ªå…·ä½“ç±»åªæ˜¯å¯¹ç«‹åœºçš„ç®€å•å°è£…ã€‚

ä½¿ç”¨ç¤ºä¾‹
--------
>>> from agents import DebateAgentA, DebateAgentB
>>> agent_a = DebateAgentA()
>>> agent_b = DebateAgentB()
>>> 
>>> # ç¬¬ä¸€è½®å‘è¨€ (æ— å¯¹æ–¹è§‚ç‚¹)
>>> view_a = agent_a.debate("äººå·¥æ™ºèƒ½æ˜¯å¦ä¼šå–ä»£äººç±»å·¥ä½œ")
>>> 
>>> # åç»­è½®æ¬¡ (æœ‰å¯¹æ–¹è§‚ç‚¹ï¼Œéœ€åé©³)
>>> view_b = agent_b.debate("äººå·¥æ™ºèƒ½æ˜¯å¦ä¼šå–ä»£äººç±»å·¥ä½œ", opponent_view=view_a)
"""

from typing import Optional, List, Dict
from .base_agent import BaseAgent


class DebateAgent(BaseAgent):
    """
    è¾©è®ºæ™ºèƒ½ä½“åŸºç±»
    
    é€šè¿‡ stance å‚æ•°æ§åˆ¶æ­£æ–¹/åæ–¹ç«‹åœºï¼Œå®ç°ä»£ç å¤ç”¨ã€‚
    æ­£æ–¹å’Œåæ–¹å…±äº«ç›¸åŒçš„è¾©è®ºé€»è¾‘ï¼Œåªæœ‰ç«‹åœºå’Œæç¤ºè¯ä¸åŒã€‚
    
    Attributes
    ----------
    stance : str
        ç«‹åœºæ ‡è¯†ï¼Œ"pro" è¡¨ç¤ºæ­£æ–¹ï¼Œ"con" è¡¨ç¤ºåæ–¹
    config : dict
        å½“å‰ç«‹åœºçš„é…ç½®ä¿¡æ¯
        
    Class Attributes
    ----------------
    STANCES : dict
        ç«‹åœºé…ç½®å­—å…¸ï¼ŒåŒ…å«æ­£æ–¹å’Œåæ–¹çš„æ‰€æœ‰é…ç½®
    """
    
    # =========================================================================
    # ç«‹åœºé…ç½® - å®šä¹‰æ­£æ–¹å’Œåæ–¹çš„å·®å¼‚åŒ–è®¾ç½®
    # =========================================================================
    STANCES = {
        "pro": {
            "name": "æ™ºèƒ½ä½“A",
            "role": "è¾©è®ºè€…A - æ­£æ–¹",
            "position": "æ­£æ–¹",
            "opponent": "åæ–¹",
            "action": "æ”¯æŒ",
            "search_keywords": "ä¼˜åŠ¿ å¥½å¤„ æ”¯æŒ",
            "examples": [
                'è¾©é¢˜"æ˜¯å¦åº”è¯¥å •èƒ" â†’ ä½ æ”¯æŒå •èƒæƒ',
                'è¾©é¢˜"AIæ˜¯å¦ä¼šå–ä»£äººç±»" â†’ ä½ è®¤ä¸ºä¼šå–ä»£',
                'è¾©é¢˜"åº”è¯¥ç¦æ­¢å¸çƒŸå—" â†’ ä½ æ”¯æŒç¦æ­¢'
            ]
        },
        "con": {
            "name": "æ™ºèƒ½ä½“B",
            "role": "è¾©è®ºè€…B - åæ–¹",
            "position": "åæ–¹",
            "opponent": "æ­£æ–¹",
            "action": "åå¯¹",
            "search_keywords": "é£é™© é—®é¢˜ åå¯¹",
            "examples": [
                'è¾©é¢˜"æ˜¯å¦åº”è¯¥å •èƒ" â†’ ä½ åå¯¹å •èƒæƒ',
                'è¾©é¢˜"AIæ˜¯å¦ä¼šå–ä»£äººç±»" â†’ ä½ è®¤ä¸ºä¸ä¼šå–ä»£',
                'è¾©é¢˜"åº”è¯¥ç¦æ­¢å¸çƒŸå—" â†’ ä½ åå¯¹ç¦æ­¢'
            ]
        }
    }
    
    def __init__(self, stance: str = "pro", use_search: bool = True, use_rag: bool = True):
        """
        åˆå§‹åŒ–è¾©è®ºæ™ºèƒ½ä½“
        
        Parameters
        ----------
        stance : str, optional
            ç«‹åœºé€‰æ‹© (é»˜è®¤: "pro")
            - "pro": æ­£æ–¹ï¼Œæ”¯æŒè¾©é¢˜ä¸»å¼ 
            - "con": åæ–¹ï¼Œåå¯¹è¾©é¢˜ä¸»å¼ 
        use_search : bool, optional
            æ˜¯å¦å¯ç”¨ç½‘ç»œæœç´¢ (é»˜è®¤: True)
        use_rag : bool, optional
            æ˜¯å¦å¯ç”¨ RAG çŸ¥è¯†åº“ (é»˜è®¤: True)
        """
        self.stance = stance
        self.config = self.STANCES[stance]
        super().__init__(
            name=self.config["name"],
            role=self.config["role"],
            use_search=use_search,
            use_rag=use_rag
        )
    
    def _build_system_prompt(self) -> str:
        """
        æ„å»ºç³»ç»Ÿæç¤ºè¯
        
        æ ¹æ®ç«‹åœºé…ç½®ç”Ÿæˆå¯¹åº”çš„è§’è‰²æç¤ºè¯ï¼Œ
        æ˜ç¡®æ™ºèƒ½ä½“çš„ç«‹åœºã€è¾©è®ºåŸåˆ™å’Œè¾“å‡ºæ ¼å¼ã€‚
        """
        cfg = self.config
        examples = "\n".join(f"- {e}" for e in cfg["examples"])
        
        return f"""ä½ æ˜¯è¾©è®ºæ™ºèƒ½ä½“ï¼Œæ‹…ä»»æœ¬æ¬¡è¾©è®ºçš„ã€{cfg["position"]}ã€‘ç«‹åœºã€‚

ã€æ ¸å¿ƒèº«ä»½ã€‘
ä½ æ˜¯{cfg["position"]}è¾©æ‰‹ï¼Œå¿…é¡»{cfg["action"]}è¾©é¢˜ä¸­çš„ä¸»å¼ ã€‚æ— è®ºè¾©é¢˜æ˜¯ä»€ä¹ˆï¼Œä½ éƒ½è¦ä»{cfg["action"]}çš„è§’åº¦è¿›è¡Œè®ºè¯ã€‚
ä¾‹å¦‚ï¼š
{examples}

ã€è¾©è®ºåŸåˆ™ã€‘
1. åšå®š{cfg["position"]}ï¼šä½ å¿…é¡»åšæŒ{cfg["position"]}ç«‹åœºï¼Œ{cfg["action"]}è¾©é¢˜ä¸­çš„ä¸»å¼ 
2. èšç„¦ä¸»é¢˜ï¼šæ‰€æœ‰è®ºè¿°å¿…é¡»ç´§æ‰£åŸå§‹é—®é¢˜ï¼Œä¸è¦åç¦»è¯é¢˜
3. é’ˆé”‹ç›¸å¯¹ï¼šé’ˆå¯¹å¯¹æ–¹çš„ã€åŸåˆ›è§‚ç‚¹ã€‘è¿›è¡Œåé©³ï¼ŒæŒ‡å‡ºå…¶é€»è¾‘æ¼æ´æˆ–äº‹å®é”™è¯¯
4. æœ‰é™è®©æ­¥ï¼šå¯ä»¥æ‰¿è®¤å¯¹æ–¹æŸäº›ç»†èŠ‚åˆç†ï¼Œä½†ç»ä¸åŠ¨æ‘‡æ ¸å¿ƒç«‹åœº
5. å›åº”è£åˆ¤ï¼šå¦‚æœæœ‰è£åˆ¤åé¦ˆï¼Œå¿…é¡»é’ˆå¯¹è£åˆ¤æŒ‡å‡ºçš„é—®é¢˜é€ä¸€å›åº”
6. ã€ç¦æ­¢é‡å¤ã€‘ï¼š**ç»å¯¹ä¸è¦é‡å¤**ä½ ä¹‹å‰å·²ç»è¡¨è¾¾è¿‡çš„è§‚ç‚¹æˆ–è®ºæ®ï¼

ã€âš ï¸âš ï¸âš ï¸ æœ€é‡è¦ï¼šåŒºåˆ†"æˆ‘çš„è§‚ç‚¹" vs "å¯¹æ–¹çš„è§‚ç‚¹"ã€‘
åœ¨å†å²è®°å½•ä¸­ï¼š
- æ ‡æ³¨ã€æˆ‘æ–¹ã€‘çš„å†…å®¹ = ä½ è‡ªå·±ä¹‹å‰è¯´è¿‡çš„è¯
- æ ‡æ³¨ã€å¯¹æ–¹ã€‘çš„å†…å®¹ = å¯¹æ–¹è¯´çš„è¯

å½“å¯¹æ–¹è¯´ã€Œå¯¹æ–¹è¯´ï¼š'xxx'ã€æˆ–å¼•ç”¨æŸå¥è¯æ—¶ï¼š
- è¢«å¼•ç”¨çš„'xxx' = å¾ˆå¯èƒ½æ˜¯ä½ è‡ªå·±ä¹‹å‰è¯´è¿‡çš„è¯ï¼ˆå»å†å²è®°å½•é‡Œç¡®è®¤ï¼ï¼‰
- å¯¹æ–¹åœ¨å¼•ç”¨ä¹‹åçš„è¯„è®º/æ‰¹è¯„ = å¯¹æ–¹çš„åŸåˆ›è§‚ç‚¹ï¼ˆè¿™æ‰æ˜¯ä½ è¦åé©³çš„ï¼‰

â›” ç»å¯¹ç¦æ­¢ï¼šæŠŠè‡ªå·±è¯´è¿‡çš„è¯å½“æˆå¯¹æ–¹çš„è§‚ç‚¹æ¥åé©³ï¼
âœ… æ­£ç¡®åšæ³•ï¼šå…ˆåœ¨å†å²è®°å½•ã€æˆ‘æ–¹ã€‘éƒ¨åˆ†ç¡®è®¤ï¼Œå¦‚æœæ˜¯è‡ªå·±è¯´çš„ï¼Œå°±ä¸è¦åé©³å®ƒï¼Œè€Œæ˜¯åé©³å¯¹æ–¹å¯¹å®ƒçš„æ‰¹è¯„

ã€è®ºæ®ä¸€è‡´æ€§è¦æ±‚ã€‘
ä½ çš„æ¯ä¸€ä¸ªè®ºæ®éƒ½å¿…é¡»**ç›´æ¥æ”¯æŒ**ä½ çš„{cfg["position"]}ç«‹åœºï¼š
- ä½ æ˜¯{cfg["position"]}ï¼Œå¿…é¡»{cfg["action"]}è¾©é¢˜ä¸»å¼ 
- æ£€æŸ¥ï¼šä½ ä¸¾çš„ä¾‹å­ã€æ•°æ®ã€æ¨ç†æ˜¯å¦çœŸçš„æ”¯æŒ{cfg["action"]}ï¼Ÿ
- å¦‚æœè®ºæ®åè€Œæ”¯æŒå¯¹æ–¹ç«‹åœºï¼Œç«‹å³åˆ é™¤å¹¶æ¢ä¸€ä¸ª

è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œè¯­è¨€çŠ€åˆ©æœ‰åŠ›ï¼Œåšå®šæå«{cfg["position"]}ç«‹åœºï¼"""
    
    def debate(self, topic: str, opponent_view: Optional[str] = None,
               use_tools: bool = False, judge_feedback: Optional[str] = None,
               debate_history: Optional[List[Dict]] = None) -> str:
        """
        è¿›è¡Œè¾©è®ºå‘è¨€
        
        Parameters
        ----------
        topic : str
            è¾©è®ºä¸»é¢˜
        opponent_view : str, optional
            å¯¹æ–¹çš„æœ€æ–°è§‚ç‚¹ (é¦–è½®å‘è¨€æ—¶ä¸º None)
        use_tools : bool, optional
            æ˜¯å¦ä½¿ç”¨æœç´¢/RAGå·¥å…·è·å–ä¿¡æ¯ (é»˜è®¤: False)
        judge_feedback : str, optional
            è£åˆ¤çš„è¯„åˆ¤å’Œå»ºè®® (é¦–è½®å‘è¨€æ—¶ä¸º None)
        debate_history : List[Dict], optional
            å®Œæ•´çš„è¾©è®ºå†å²è®°å½•ï¼ŒåŒ…å«ä¹‹å‰æ‰€æœ‰è½®æ¬¡çš„å‘è¨€
            
        Returns
        -------
        str
            ç”Ÿæˆçš„è¾©è®ºå‘è¨€å†…å®¹
        """
        cfg = self.config
        context = ""
        
        # ä½¿ç”¨å·¥å…·è·å–å¤–éƒ¨ä¿¡æ¯ä½œä¸ºè®ºæ®æ”¯æ’‘
        if use_tools:
            if self.search_tool:
                context += self.search(f"{topic} {cfg['search_keywords']}")
            if self.rag_tool:
                context += self.retrieve(topic)
        
        # æ„å»ºè¾©è®ºå†å²æ‘˜è¦ï¼Œæ˜ç¡®æ ‡æ³¨æˆ‘æ–¹å’Œå¯¹æ–¹çš„è§‚ç‚¹
        history_summary = ""
        my_previous_points = []  # æ”¶é›†æˆ‘æ–¹ä¹‹å‰çš„æ ¸å¿ƒè§‚ç‚¹
        if debate_history:
            my_key = 'agent_a' if self.stance == 'pro' else 'agent_b'
            my_label = 'ã€æˆ‘æ–¹ã€‘' if self.stance == 'pro' else 'ã€æˆ‘æ–¹ã€‘'
            opp_key = 'agent_b' if self.stance == 'pro' else 'agent_a'
            opp_label = 'ã€å¯¹æ–¹ã€‘'
            
            history_summary = "\n" + "=" * 50 + "\n"
            history_summary += "ğŸ“œ å†å²è¾©è®ºè®°å½•ï¼ˆè¯·ä»”ç»†åŒºåˆ†æˆ‘æ–¹vså¯¹æ–¹è§‚ç‚¹ï¼ï¼‰\n"
            history_summary += "=" * 50 + "\n"
            
            for record in debate_history:
                history_summary += f"\n--- ç¬¬ {record['round']} è½® ---\n"
                my_view = record[my_key]
                opp_view = record[opp_key]
                
                # æ”¶é›†æˆ‘æ–¹è§‚ç‚¹æ‘˜è¦
                my_previous_points.append(my_view[:200])
                
                history_summary += f"\n{my_label}ï¼ˆè¿™æ˜¯ä½ è‡ªå·±è¯´çš„ï¼ï¼‰ï¼š\n{my_view[:350]}...\n" if len(my_view) > 350 else f"\n{my_label}ï¼ˆè¿™æ˜¯ä½ è‡ªå·±è¯´çš„ï¼ï¼‰ï¼š\n{my_view}\n"
                history_summary += f"\n{opp_label}ï¼ˆè¿™æ˜¯å¯¹æ–¹è¯´çš„ï¼‰ï¼š\n{opp_view[:350]}...\n" if len(opp_view) > 350 else f"\n{opp_label}ï¼ˆè¿™æ˜¯å¯¹æ–¹è¯´çš„ï¼‰ï¼š\n{opp_view}\n"
            
            history_summary += "\n" + "=" * 50 + "\n"
            
            # æ·»åŠ æˆ‘æ–¹è§‚ç‚¹æ‘˜è¦æé†’
            history_summary += "\nâš ï¸ ä½ ä¹‹å‰è¯´è¿‡çš„æ ¸å¿ƒè§‚ç‚¹ï¼ˆä¸è¦è¯¯è®¤ä¸ºæ˜¯å¯¹æ–¹çš„è§‚ç‚¹ï¼ï¼‰ï¼š\n"
            for i, point in enumerate(my_previous_points, 1):
                history_summary += f"  {i}. {point[:150]}...\n"
            history_summary += "\n"
        
        # æ ¹æ®æ˜¯å¦æœ‰å¯¹æ–¹è§‚ç‚¹æ„å»ºä¸åŒçš„æç¤º
        if opponent_view:
            # æœ‰å¯¹æ–¹è§‚ç‚¹ï¼Œéœ€è¦åé©³
            prompt = f"ã€è¾©è®ºä¸»é¢˜ã€‘{topic}\n"
            if history_summary:
                prompt += history_summary
            prompt += f"\nã€{cfg['opponent']}çš„æœ€æ–°å‘è¨€ã€‘\n{opponent_view}\n"
            prompt += f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸ æå…¶é‡è¦ï¼šå¦‚ä½•æ­£ç¡®è¯†åˆ«"å¯¹æ–¹çš„åŸåˆ›è§‚ç‚¹"              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  å½“å¯¹æ–¹è¯´ã€Œå¯¹æ–¹è¯´ï¼š'xxx'ã€æˆ–ã€Œé’ˆå¯¹{cfg['position']}çš„'xxx'ã€æ—¶ï¼š    â•‘
â•‘  â†’ 'xxx' æ˜¯ã€ä½ è‡ªå·±ä¹‹å‰è¯´çš„è¯ã€‘ï¼Œä¸æ˜¯å¯¹æ–¹çš„è§‚ç‚¹ï¼        â•‘
â•‘  â†’ å¯¹æ–¹åœ¨å¼•ç”¨ä¹‹åçš„åé©³/è¯„è®ºæ‰æ˜¯ã€å¯¹æ–¹çš„åŸåˆ›è§‚ç‚¹ã€‘       â•‘
â•‘                                                          â•‘
â•‘  ä¾‹å¦‚ï¼Œå¦‚æœå¯¹æ–¹è¯´ï¼š                                      â•‘
â•‘  ã€Œå¯¹æ–¹è¯´ï¼š'æŠ€æœ¯ä¼šè¿›æ­¥'ã€â†’ è¿™ä¸ªè§‚ç‚¹å¿½è§†äº†ç‰©ç†é™åˆ¶...    â•‘
â•‘                                                          â•‘
â•‘  é‚£ä¹ˆï¼š                                                  â•‘
â•‘  âœ— 'æŠ€æœ¯ä¼šè¿›æ­¥' = ä½ è‡ªå·±è¯´çš„ï¼ˆä¸è¦åé©³è‡ªå·±ï¼ï¼‰          â•‘
â•‘  âœ“ 'å¿½è§†äº†ç‰©ç†é™åˆ¶' = å¯¹æ–¹çš„åŸåˆ›è§‚ç‚¹ï¼ˆè¿™æ‰è¦åé©³ï¼‰      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
            if judge_feedback:
                prompt += f"\nã€è£åˆ¤Cçš„è¯„åˆ¤å’Œå»ºè®®ã€‘\n{judge_feedback}\n"
            
            # åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬æ™ºèƒ½ä½“çš„é¦–æ¬¡å‘è¨€ï¼ˆæœ‰å¯¹æ–¹è§‚ç‚¹ä½†æ— å†å²è®°å½• = Bçš„é¦–è½®ï¼‰
            is_my_first_speech = not debate_history
            
            if is_my_first_speech:
                # Bçš„é¦–è½®å‘è¨€ï¼šæœ‰Açš„è§‚ç‚¹éœ€è¦åé©³ï¼Œä½†è¿™æ˜¯Bçš„é¦–æ¬¡å‘è¨€
                prompt += f"""
ä½ æ˜¯{cfg['position']}ï¼Œè¿™æ˜¯ä½ çš„é¦–æ¬¡å‘è¨€ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›å¤ï¼š
1. ã€æˆ‘çš„ç«‹åœºã€‘ï¼šæ˜ç¡®è¡¨æ€{cfg['action']}è¾©é¢˜ä¸»å¼ ï¼ˆä¸€å¥è¯ï¼‰
2. ã€æ ¸å¿ƒè®ºæ®ã€‘ï¼š2-3ä¸ª{cfg['action']}è¾©é¢˜çš„æœ‰åŠ›è®ºæ®
   âš ï¸ æ£€æŸ¥ï¼šæ¯ä¸ªè®ºæ®æ˜¯å¦çœŸçš„æ”¯æŒ"{cfg['action']}"ï¼Ÿä¸æ”¯æŒå°±åˆ æ‰æ¢ä¸€ä¸ª
3. ã€åé©³å¯¹æ–¹è§‚ç‚¹ã€‘ï¼š
   - å¯¹æ–¹çš„è§‚ç‚¹ï¼šã€Œ...ã€
   - æˆ‘çš„åé©³ï¼š..."""
            else:
                # åç»­è½®æ¬¡ï¼šéœ€è¦æå‡ºæ–°è®ºæ®ï¼Œä¸èƒ½é‡å¤
                prompt += f"""
ä½ æ˜¯{cfg['position']}ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›å¤ï¼š
1. ã€æˆ‘çš„ç«‹åœºã€‘ï¼šä¸€å¥è¯è¡¨æ€{cfg['action']}
2. ã€æ–°è®ºæ®ã€‘ï¼š1-2ä¸ª**ä¹‹å‰æœªæè¿‡çš„**æ–°è®ºæ®
   âš ï¸ æ£€æŸ¥å†å²è®°å½•ä¸­ã€æˆ‘æ–¹ã€‘çš„å‘è¨€ï¼Œç¡®ä¿ä¸é‡å¤ï¼
3. ã€åé©³å¯¹æ–¹è§‚ç‚¹ã€‘ï¼š
   âš ï¸ æ³¨æ„ï¼šåé©³çš„å¿…é¡»æ˜¯å¯¹æ–¹çš„è§‚ç‚¹ï¼Œä¸æ˜¯ä½ è‡ªå·±ä¹‹å‰è¯´çš„è¯ï¼
   - å¯¹æ–¹çš„è§‚ç‚¹ï¼šã€Œ...ã€
   - æˆ‘çš„åé©³ï¼š...
4. ã€å›åº”å¯¹æ–¹å¯¹æˆ‘çš„è´¨ç–‘ã€‘ï¼šå¯¹æ–¹æ‰¹è¯„äº†æˆ‘çš„å“ªäº›è§‚ç‚¹ï¼Ÿæˆ‘å¦‚ä½•å›åº”ï¼Ÿ

âš ï¸ å†æ¬¡æé†’ï¼šä¸Šæ–¹å†å²è®°å½•ä¸­æ ‡æ³¨ã€æˆ‘æ–¹ã€‘çš„å†…å®¹æ˜¯ä½ è‡ªå·±è¯´çš„ï¼Œä¸è¦è¯¯è®¤ä¸ºæ˜¯å¯¹æ–¹çš„è§‚ç‚¹ï¼"""
            if judge_feedback:
                prompt += f"\n5. ã€å›åº”è£åˆ¤ã€‘ï¼šé’ˆå¯¹è£åˆ¤æŒ‡å‡ºçš„é—®é¢˜é€ä¸€å›åº”"
        else:
            # Açš„é¦–è½®å‘è¨€ï¼šé™ˆè¿°ç«‹åœºå’Œè®ºæ®ï¼Œå¹¶é¢„åˆ¤å¯¹æ–¹å¯èƒ½çš„åé©³
            prompt = f"""ã€è¾©è®ºä¸»é¢˜ã€‘{topic}

ä½ æ˜¯{cfg['position']}ï¼Œè¿™æ˜¯ä½ çš„é¦–æ¬¡å‘è¨€ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›å¤ï¼š
1. ã€æˆ‘çš„ç«‹åœºã€‘ï¼šæ˜ç¡®è¡¨æ€{cfg['action']}è¾©é¢˜ä¸»å¼ ï¼ˆä¸€å¥è¯ï¼‰
2. ã€æ ¸å¿ƒè®ºæ®ã€‘ï¼š2-3ä¸ª{cfg['action']}è¾©é¢˜çš„æœ‰åŠ›è®ºæ®
   âš ï¸ æ£€æŸ¥ï¼šæ¯ä¸ªè®ºæ®æ˜¯å¦çœŸçš„æ”¯æŒ"{cfg['action']}"ï¼Ÿä¸æ”¯æŒå°±åˆ æ‰æ¢ä¸€ä¸ª
3. ã€é¢„åˆ¤å¹¶åé©³å¯¹æ–¹å¯èƒ½çš„è®ºæ®ã€‘ï¼šæ€è€ƒ{cfg['opponent']}å¯èƒ½ä¼šæå‡ºä»€ä¹ˆè®ºæ®ï¼Œæå‰åé©³ï¼š
   - å¯¹æ–¹å¯èƒ½è¯´ï¼šã€Œ...ã€
   - æˆ‘çš„é¢„å…ˆåé©³ï¼š...

æ³¨æ„ï¼šè¿™æ˜¯é¦–è½®å‘è¨€ï¼Œä¸éœ€è¦å›åº”è£åˆ¤ã€‚"""
        
        return self.generate(prompt, context)


# =============================================================================
# å…·ä½“æ™ºèƒ½ä½“ç±» - ä¸ºä¾¿äºä½¿ç”¨æä¾›çš„ç®€å•å°è£…
# =============================================================================

class DebateAgentA(DebateAgent):
    """
    æ­£æ–¹è¾©è®ºæ™ºèƒ½ä½“
    
    æ”¯æŒè¾©é¢˜ä¸»å¼ ï¼Œä»ç§¯æ/è‚¯å®šçš„è§’åº¦è¿›è¡Œè®ºè¯ã€‚
    
    ä½¿ç”¨ç¤ºä¾‹
    --------
    >>> agent = DebateAgentA()
    >>> view = agent.debate("äººå·¥æ™ºèƒ½æ˜¯å¦ä¼šå–ä»£äººç±»å·¥ä½œ")
    """
    def __init__(self, use_search: bool = True, use_rag: bool = True):
        super().__init__(stance="pro", use_search=use_search, use_rag=use_rag)


class DebateAgentB(DebateAgent):
    """
    åæ–¹è¾©è®ºæ™ºèƒ½ä½“
    
    åå¯¹è¾©é¢˜ä¸»å¼ ï¼Œä»å®¡æ…/å¦å®šçš„è§’åº¦è¿›è¡Œè®ºè¯ã€‚
    
    ä½¿ç”¨ç¤ºä¾‹
    --------
    >>> agent = DebateAgentB()
    >>> view = agent.debate("äººå·¥æ™ºèƒ½æ˜¯å¦ä¼šå–ä»£äººç±»å·¥ä½œ", opponent_view="...")
    """
    def __init__(self, use_search: bool = True, use_rag: bool = True):
        super().__init__(stance="con", use_search=use_search, use_rag=use_rag)
